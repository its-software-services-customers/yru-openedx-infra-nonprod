rkeCluster:
  vsphereProvisioner:
    groupName: "rke-demo-sandbox"

    vcHost: ""
    vcDc: "TDMP-AAA-MTG8E-DC01"
    vcDataStore: "DS03_D2P-AAAVMSTOR01_NPRD_ANTHOS"
    vcPoolName: "Sandbox-Rancher"
    vcVAppName: ""
    vcCluster: "TDMP-AAA-CL02-NON-PROD"
    
    affinityRule:
      enabled: false
      affinityGroups: ['worker', 'master']

  cluster:
    clusterYaml: "rke-normalized-cfg.yaml" #Render on the fly from rke-config.yaml
    cluster_name: "rke-demo-sandbox"
    kubernetes_version: "v1.20.8-rancher1-1"
    ignore_docker_version: true
    prefix_path: "/var/lib/toolbox/rke" #CoreOs need to use this path

    outputs:
      - kube_config_yaml      
      - rke_state

    #===============================
    profiles:
      workerStatic:
        type: staticProvisioner
        localSshPrivateKeyPath: "id_rsa"
        sshUser: "devops"

      masterVsphere-001:
        type: vsphereProvisioner
        terraformVmModule: "gcs::https://www.googleapis.com/storage/v1/tdg-terraform-modules/terraform-vsphere-vm/1.0.11/modules.zip//modules"      
        vcenterTemplate: ""
        localProvisionerFile: "k8s-node-provisioner.bash"
        localSshPrivateKeyPath: "id_rsa"
        localSshPubKeyPath: "id_rsa.pub"
        sshUser: "devops"
        adminUser: "dummy"
        adminPassword: "fakEpassword"
        memorySize: 4096
        cpuNum: 4
        guestId: "centos7_64Guest"
        imageLibName: "PACKER_VM_TEMPLATE"
        imageLibItemName: "vcenter-centos7-rke-20210702-1038"      
        disks:
          bootDiskSize: 75
          externals:
            - index: 1
              diskSize: 20
        networks:
          defaultNetworkIndex: 0
          defaultGateWay: "10.100.103.254"
          dnsList: '["172.22.192.1", "172.22.192.2"]'
          interfaces:
            - index: 1
              vcNetwork: "ANTHOS_NPRD_USER_VLAN3303"
              netmask: 24

      workerVsphere-001:
        type: vsphereProvisioner
        terraformVmModule: "gcs::https://www.googleapis.com/storage/v1/tdg-terraform-modules/terraform-vsphere-vm/1.0.11/modules.zip//modules"      
        vcenterTemplate: ""
        localProvisionerFile: "k8s-node-provisioner.bash"
        localSshPrivateKeyPath: "id_rsa"
        localSshPubKeyPath: "id_rsa.pub"
        sshUser: "devops"
        adminUser: "dummy"
        adminPassword: "fakEpassword"
        memorySize: 4096
        cpuNum: 4
        guestId: "centos7_64Guest"
        imageLibName: "PACKER_VM_TEMPLATE"
        imageLibItemName: "vcenter-centos7-rke-20210702-1038"      
        disks:
          bootDiskSize: 75
          externals:
            - index: 1
              diskSize: 20
        networks:
          defaultNetworkIndex: 0
          defaultGateWay: "10.100.103.254"
          dnsList: '["172.22.192.1", "172.22.192.2"]'
          interfaces:
            - index: 1
              vcNetwork: "ANTHOS_NPRD_USER_VLAN3303"
              netmask: 24

      workerVsphere-002:
        type: vsphereProvisioner
        terraformVmModule: "gcs::https://www.googleapis.com/storage/v1/tdg-terraform-modules/terraform-vsphere-vm/1.0.11/modules.zip//modules"      
        vcenterTemplate: ""
        localProvisionerFile: "k8s-node-provisioner.bash"
        localSshPrivateKeyPath: "id_rsa"
        localSshPubKeyPath: "id_rsa.pub"
        sshUser: "devops"
        adminUser: "dummy"
        adminPassword: "fakEpassword"
        memorySize: 4096
        cpuNum: 4
        guestId: "centos7_64Guest"
        imageLibName: "PACKER_VM_TEMPLATE"
        imageLibItemName: "vcenter-centos7-rke-20210702-1038"      
        disks:
          bootDiskSize: 100
          externals:
            - index: 1
              diskSize: 20
        networks:
          defaultNetworkIndex: 0
          defaultGateWay: "10.100.103.254"
          dnsList: '["172.22.192.1", "172.22.192.2"]'
          interfaces:
            - index: 1
              vcNetwork: "ANTHOS_NPRD_USER_VLAN3303"
              netmask: 24

    # Instances
    instances:
      - host: "aaa1d-rke-demo-master-01"
        ip: ["10.100.103.71"]
        profile: "masterVsphere-001"
        mode: "register" # register, unregister, remove
        role: '["controlplane", "etcd"]'
        antiAffinityGroup: master

      #=========================
      - host: "aaa1d-rke-demo-worker-01"
        ip: ["10.100.103.76"]
        profile: "workerVsphere-001"
        mode: "register"
        role: '["worker"]'
        antiAffinityGroup: worker

      - host: "aaa1d-rke-demo-worker-02"
        ip: ["10.100.103.77"]
        profile: "workerVsphere-002"
        mode: "register"
        role: '["worker"]'
        antiAffinityGroup: worker

      - host: "aaa1d-rke-demo-worker-03"
        ip: ["10.100.103.78"]
        profile: "workerVsphere-001"
        mode: "register"
        role: '["worker"]'
        antiAffinityGroup: worker
